<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>121 Comms</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/styleSheet.css') }}">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>

<body>

<div class="fullWidthDiv">
    <div class="maxWidthDiv">

        <div class="logoDiv">
            <img src="{{ url_for('static', filename='images/Logo-121.png') }}" alt="121Logo" />
        </div>

        <div class="bodyTextCont">
            <b>Your AI-Powered 121 Marketing Communication Engine</b>
            <p>Generate personalized, one-to-one communication for Email, SMS and WhatsApp.</p>
        </div>

        <ul class="tabsButtons">
            <li class="active-btn">CREATE NEW</li>
            <li>IMPROVE EXISTING</li>
        </ul>

        <ul class="tabsContent">

            <!-- ✅ Create New Form -->
            <li class="active-tab">
            <form name="createnewForm" action="/createnew" method="post">

            <!-- <form action="/createnew" method="post"> ✅ Wrap all inputs inside form -->

                <div class="parentDiv">
                    <div class="chidDivs_2">
                        <div class="labelDiv reqField">Category</div>
                        <div class="inptCont">
                            <input list="SelectCategory" id="category" name="category" class="commonInpt dataList" placeholder="Select or Input Category" required />
                            <datalist id="SelectCategory">
                                <option value="Fashion & Apparel"></option>
                                <option value="Beauty & Personal Care"></option>
                                <option value="Health & Wellness"></option>
                                <option value="Food & Beverages"></option>
                                <option value="Tech & Gadgets"></option>
                                <option value="Financial Services & Insurance"></option>
                                <option value="Entertainment & Media"></option>
                                <option value="Arts & Crafts"></option>
                                <option value="Automotive & Accessories"></option>
                            </datalist>
                        </div>
						<p class="formError_text" id="">error message</p>
                    </div>
                    <div class="chidDivs_2">
                        <div class="labelDiv reqField">Brand</div>
                        <div class="inptCont">
                            <input type="text" name="brand" class="commonInpt" placeholder="Input Brand Name" required />
                        </div>
						<p class="formError_text" id="">error message</p>
                    </div>
                </div>

                <div class="parentDiv">
                    <div class="chidDivs_2">
                        <div class="labelDiv reqField">State Objective</div>
                        <div class="inptCont">
                            <input type="text" identifier="objective" name="objective" class="commonInpt" placeholder="Input Here (max. 75 characters)" 
                                required maxlength="76" onkeyup="validateLength(this, 75)" />
                            <span class="errormessage" style="color: red; font-size: 14px; display: none;">Character limit exceeded! Max 75 characters allowed.</span>

                            <!-- <input type="text" name="objective" class="commonInpt" placeholder="Input Here (max. 50 characters)" required /> -->
                        </div>
						<!-- <p class="formError_text" id="">error message</p> -->
                        <p class="formError_text" id="objectiveError">error message</p>

                    </div>
					<div class="chidDivs_2">
						<div class="labelDiv reqField">Action / CTA</div>
						<div class="inptCont">
							<!-- Input with datalist for both selecting and custom input -->
							<input list="SelectActionOrCTA" name="cta_button" id="cta_button_input" class="commonInpt dataList" placeholder="Select or Input CTA" required />
							<datalist id="SelectActionOrCTA">
								<!-- Predefined CTA options will be added dynamically here -->
							</datalist>
						</div>
						<p class="formError_text" id="">error message</p>
					</div>
                </div>

                <div class="parentDiv">
                    <div class="chidDivs_2">
                        <div class="labelDiv">Offer/ Incentive</div>
                        <div class="inptCont">
                            <input type="text" identifier = "offer" name="offer" class="commonInpt" placeholder="Input Here (max. 50 characters)" 
                            maxlength="51" onkeyup="validateLength(this, 50)" />
                            <span class="errormessage" style="color: red; font-size: 14px; display: none;">Character limit exceeded! Max 50 characters allowed.</span>
                        </div>
						<!-- <p class="formError_text" id="">error message</p> -->
                        <p class="formError_text" id="offerError">error message</p>

                    </div>
                    <div class="chidDivs_2">
                        <div class="labelDiv">Any specific comments</div>
                        <div class="inptCont">
                            <input type="text" identifier = "specific_input_create" name="specific_input" class="commonInpt" placeholder="Input Here (max. 75 characters)" 
                            maxlength="76" onkeyup="validateLength(this, 75)" />
                            <span class="errormessage" style="color: red; font-size: 14px; display: none;">Character limit exceeded! Max 75 characters allowed.</span>
                        </div>
						<!-- <p class="formError_text" id="">error message</p> -->
                        <p class="formError_text" id="specific_input_createError">error message</p>

                    </div>
                </div>

                <div class="parentDiv">
                    <div class="chidDivs_2">
                        <div class="labelDiv reqField">Medium</div>
                        <div class="inptCont">
                            <select name="medium" class="commonInpt" required>
                                <option value="">Select Medium</option>
                                <option value="email">Email</option>
                                <option value="sms">SMS</option>
                                <option value="whatsapp">WhatsApp</option>
                            </select>
                        </div>
						<p class="formError_text" id="">error message</p>
                    </div>
                    <div class="chidDivs_2">
                        <div class="labelDiv">Tonality</div>
                        <div class="inptCont">
                            <input list="SelectTonality" name="tone" class="commonInpt dataList" placeholder="Select or Input Tonality" />
                            <datalist id="SelectTonality">
								<option value="Anticipation"></option>
								<option value="Joy"></option>
								<option value="Trust"></option>
								<option value="Fear of Missing Out(FOMO)"></option>
								<option value="Surprise"></option>
								<option value="Excitement"></option>
								<option value="Curiosity"></option>
								<option value="Calmness"></option>
								<option value="Security"></option>
								<option value="Kindness"></option>
								<option value="Admiration"></option>
								<option value="Thankfulness"></option>
								<option value="Hope"></option>
								<option value="Reliability"></option>
                            </datalist>
                        </div>
						<p class="formError_text" id="">error message</p>
                    </div>
                </div>

                <div class="parentDiv CTA">
                    <div class="ackText">
                        <b>Need content for AB testing</b>
                        <input type="checkbox" name="ab_testing" value="true" id="ackText_check_1" />
                        <label for="ackText_check_1"></label>
                    </div>
                    <div class="divCTA">
                        <div class="inptCont">
                            <input type="submit" class="commonInptBTN" id="createNewForm" value="Create" />
                        </div>
                    </div>
                </div>

            </form> <!-- ✅ Form closes here -->
            <div id="errorMessages"></div>

            </li> <!--CREATE NEW end-->

			<li class="hidden-tab">
                <form name="improveExisting" action="/improveexisting" method="post">

			<!-- <form action="/improveexisting" method="post"> ✅ Wrap all inputs inside form -->

			<!-- ✅ Improve Existing Section (Initially Hidden) -->
			<div class="parentDiv ">
				<div class="chidDivs_2">
					<div class="labelDiv reqField">Existing Content</div>
					<div class="inptCont">
						<textarea class="commonTextArea" name="existing_content" placeholder="Input Existing Content" required></textarea>
					</div>
					<p class="formError_text" id="">error message</p>
				</div>
			</div>

			<div class="parentDiv width50perc">
				<div class="chidDivs_2">
					<div class="labelDiv reqField">Category</div>
					<div class="inptCont">
						<input list="SelectCategory" name="category" class="commonInpt dataList" placeholder="Select or Input Category" required />
						<datalist id="SelectCategory">
							<option value="Fashion & Apparel"></option>
							<option value="Beauty & Personal Care"></option>
							<option value="Health & Wellness"></option>
							<option value="Food & Beverages"></option>
							<option value="Tech & Gadgets"></option>
							<option value="Financial Services & Insurance"></option>
							<option value="Entertainment & Media"></option>
							<option value="Arts & Crafts"></option>
							<option value="Automotive & Accessories"></option>
						</datalist>
					</div>
					<p class="formError_text" id="">error message</p>
				</div>
				<div class="chidDivs_2">
					<div class="labelDiv reqField">Brand</div>
					<div class="inptCont">
						<input type="text" name="brand" class="commonInpt" placeholder="Input Brand Name" required  />
					</div>
					<p class="formError_text" id="">error message</p>
				</div>
				<div class="chidDivs_2">
					<div class="labelDiv reqField">Medium</div>
					<div class="inptCont">
						<select name="medium" class="commonInpt" required>
							<option value="">Select Medium</option>
							<option value="email">Email</option>
							<option value="sms">SMS</option>
							<option value="whatsapp">WhatsApp</option>
						</select>
					</div>
					<p class="formError_text" id="">error message</p>
				</div>
				<div class="chidDivs_2">
					<div class="labelDiv reqField">Improvement required</div>
					<div class="inptCont">
						<input type="text" identifier="specific_input_improve" name="specific_input" class="commonInpt" placeholder="Input Here (max. 75 characters)" 
                        required maxlength="76" onkeyup="validateLength(this, 75)" />
                        <span class="errormessage" style="color: red; font-size: 14px; display: none;">Character limit exceeded! Max 75 characters allowed.</span>
					</div>
					<!-- <p class="formError_text" id="">error message</p> -->
						<p class="formError_text" id="specific_input_improveError">error message</p>

				</div>
			</div>

			<div class="parentDiv CTA">
				<div class="ackText">
					<b>Need content for AB testing</b>
					<input type="checkbox" name="ab_testing" value="true" id="ackText_check_2" />
					<label for="ackText_check_2"></label>
				</div>
				<div class="divCTA">
					<div class="inptCont">
						<input type="submit" class="commonInptBTN" id="improveExistingForm" value="Improve" />
					</div>
				</div>
			</div>

			</form> <!-- ✅ Form closes here -->
            <div id="errorMessages"></div>

			</li><!--IMPROVE EXISTING end-->

        </ul>

    </div> <!-- maxWidthDiv div end -->

<script>
        localStorage.removeItem("createNewResult");
        localStorage.removeItem("createNewData");
        localStorage.removeItem("improveExistingResult");
        localStorage.removeItem("improveData");
</script>

    <!-- Create New Result Section -->
<div id="createNewResultSection" class="fullWidthDiv" style="display: none;">
    <div class="maxWidthDiv">
        {% if content %}
            <div class="sumHeader">
                Ola - Here is the result. Donate a share on your social media if you wish.
            </div>

            <div class="summeryDiv">
                <p>{{ content }}</p>
            </div>

            <div class="smallText">
                This is a free-to-use Gen AI tool of 0101.today. Check and make brand-specific changes before you publish.
            </div>

            <script>

                localStorage.setItem("createNewResult", `{{ content|safe }}`);
                localStorage.setItem("createNewData", `{{ form_data_create|safe }}`);

                document.getElementById("createNewResultSection").style.display = "block";
                document.getElementById("createNewResultSection").scrollIntoView({ behavior: "smooth" });
            </script>
        {% endif %}
    </div>
</div> <!-- maxWidthDiv div end -->

<!-- Improve Existing Result Section -->
<div id="improveExistingResultSection" class="fullWidthDiv" style="display: none;">
    <div class="maxWidthDiv">
        {% if improve_content %}
            <div class="sumHeader">
                Ola - Here is the result. Donate a share on your social media if you wish.
            </div>

            <div class="summeryDiv">
                <p>{{ improve_content }}</p>
            </div>

            <div class="smallText">
                This is a free-to-use Gen AI tool of 0101.today. Please make sure to review the changes before publishing.
            </div>

            <!-- Store the result for Improve Existing in localStorage -->
            <script>
                localStorage.setItem("improveExistingResult", `{{ improve_content|safe }}`);
                localStorage.setItem("improveData", `{{ form_data_improve|safe }}`);

                document.getElementById("improveExistingResultSection").style.display = "block";
                document.getElementById("improveExistingResultSection").scrollIntoView({ behavior: "smooth" });

            </script>
        {% endif %}
    </div>
</div> <!-- maxWidthDiv div end -->


<div id="overlay" class="overlay" style="display: none;"></div>

<div id="loader" class="loader" style="display: none;">
    <div class="spinner"></div> <!-- Rotating ring -->
<!--     <p>Processing...</p> -->
</div>


<script>document.addEventListener("DOMContentLoaded", function () {
    function showLoader() {
        document.getElementById("loader").style.display = "block"; // Show loader
        document.getElementById("overlay").style.display = "block"; // Show overlay (gray out)
    }

    function hideLoader() {
        document.getElementById("loader").style.display = "none"; // Hide loader
        document.getElementById("overlay").style.display = "none"; // Hide overlay
    }

    function validateForm(form) {
        let isValid = true;
        const requiredFields = form.querySelectorAll("[required]");

        requiredFields.forEach(field => {
            let errorSpan = field.closest(".chidDivs_2").querySelector(".formError_text"); // Find the associated error message span

            // Check if the field is empty
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add("error"); // Add red border for error
                errorSpan.textContent = "⚠️ This field is required!"; // Show error message
                errorSpan.style.display = "inline"; // Ensure error message is shown
            } else {
                field.classList.remove("error"); // Remove red border
                errorSpan.textContent = ""; // Clear the error message
                errorSpan.style.display = "none"; // Hide the error message
            }
        });

        return isValid;
    }

    function handleFormSubmission(buttonId, formSelector) {
        document.getElementById(buttonId).addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the default form submission

            const form = document.querySelector(formSelector);
            
            // Validate the form before submitting
            if (!validateForm(form)) {
                return; // Stop if validation fails
            }

            showLoader(); // Show loader and overlay before submitting

            setTimeout(function () {
                form.submit(); // Submit form after delay
            }, 2000); // Delay for loader effect
        });
    }

    function setupLiveValidation() {
        const requiredFields = document.querySelectorAll("[required]");

        requiredFields.forEach(field => {
            field.addEventListener("input", function () {
                let errorSpan = field.closest(".chidDivs_2").querySelector(".formError_text"); // Find the associated error message span
                if (errorSpan) {
                    errorSpan.textContent = ""; // Remove the error message on input change
                    field.classList.remove("error"); // Remove red border
                }
            });
        });
    }

    // Attach event listeners to buttons for form submission
    handleFormSubmission("createNewForm", 'form[action="/createnew"]');
    handleFormSubmission("improveExistingForm", 'form[action="/improveexisting"]');

    // Set up live validation
    setupLiveValidation();
});
</script>

<script type="text/javascript" src="{{ url_for('static', filename='scripts/index.js') }}"></script>
<script type="text/javascript">
    const CTA_OPTIONS = {
        "Fashion & Apparel": ["Shop Trends", "Get Your Look", "New Arrivals", "Upgrade Now"],
        "Beauty & Personal Care": ["Glow Up", "Try Now", "Find Your Shade", "Shop Beauty"],
        "Health & Wellness": ["Start Now", "Get Healthy", "Book Now", "Feel Better"],
        "Food & Beverages": ["Order Now", "Satisfy Cravings", "Taste It", "Fresh & Delicious"],
        "Tech & Gadgets": ["Pre-Order", "Upgrade Tech", "Buy Now", "Limited Stock"],
        "Financial Services & Insurance": ["Get Quote", "Secure Future", "Compare Plans", "Start Saving"],
        "Entertainment & Media": ["Watch Now", "Get Ticket", "Stream Now", "Subscribe Now"],
        "Arts & Crafts": ["Start DIY", "Get Creative", "Buy Handmade", "Express Yourself"],
        "Automotive & Accessories": ["Test Drive", "Upgrade Ride", "Shop Accessories", "Exclusive Deals"]
    };

    // Handle category change to populate CTA options dynamically
    document.getElementById('category').addEventListener('change', function() {
        const selectedCategory = this.value;
        const ctaInput = document.getElementById('cta_button_input');
        const ctaDatalist = document.getElementById('SelectActionOrCTA');

        // Clear the datalist options
        ctaDatalist.innerHTML = '';

        // If a valid category is selected, populate the CTA options
        if (selectedCategory && CTA_OPTIONS[selectedCategory]) {
            const ctaOptions = CTA_OPTIONS[selectedCategory];
            
            // Add predefined CTA options
            ctaOptions.forEach(function(option) {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                ctaDatalist.appendChild(optionElement);
            });
        }

        // Allow user input if needed
        ctaInput.placeholder = "Select or Input CTA"; // Update placeholder when category changes
    });
</script>

<script type="text/javascript">
// For "Create New" form submission
document.getElementById("createNewForm").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent form submission to handle loader
    showLoader(); // Show loader and overlay

    setTimeout(function() {
        const form = document.querySelector('form[action="/createnew"]');
        const content = document.querySelector('.summeryDiv').innerHTML;
        
        // Save the result for "Create New" tab
        localStorage.setItem('createNewResult1', content);

        form.submit();

    }, 2000);
});

// For "Improve" form submission
document.getElementById("improveForm").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent form submission to handle loader
    showLoader(); // Show loader and overlay

    
    setTimeout(function() {
        const form = document.querySelector('form[action="/improve"]');
        const content = document.querySelector('.summeryDiv').innerHTML;
        
        // Save the result for "Improve" tab
        localStorage.setItem('improveResult1', content);

        form.submit();

    }, 2000);
});

</script>

<script>

        localStorage.setItem("createNewResult1", `{{ content|safe }}`);

</script>
                    </script>
<script>
    $(document).ready(function () {
    $(".dataList").on("focus", function () {
        $(this).val("");  // Clear the input field to allow re-selection
    });
});

</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let formData = JSON.parse('{{ form_data | safe }}')
        console.log("dfghjkl",formData)
        console.log("dfghjkl",formData.category)
        
        let formDataCN = JSON.parse('{{ form_data | safe }}')
        // console.log("formDataCN",formDataCN)
        // localStorage.setItem("CreateNewData", JSON.stringify(formDataCN));

        localStorage.setItem("Category", formData.category);
        localStorage.setItem("Medium", formData.medium);
        localStorage.setItem("Brand",formData.brand);

        // Loop through keys and populate fields dynamically
        for (let key in formData) {
            let inputField = document.querySelector(`[name="${key}"]`);
            if (inputField) {
                if (inputField.type === "checkbox") {
                    inputField.checked = formData[key];
                } else {
                    inputField.value = formData[key] || "";
                }
            }
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Retrieve the form data from localStorage
        let formData = JSON.parse(`{{ form_data_improve|safe }}`)
        let existing_content = `{{ existing_content|safe }}`
         

        console.log("....",formData);  // Log the data to check
        console.log(existing_content)
        // Check if formData exists in localStorage before attempting to populate the fields
        if (formData) {

            $("textarea[name='existing_content']").val(existing_content || "");

            $("input[name='category']").val(formData.category || "");
            $("input[name='brand']").val(formData.brand || "");
            $("select[name='medium']").val(formData.medium || "");
            $("input[name='specific_input']").val(formData.specific_input || "");  // New field for specific_content

            // If there's a checkbox for AB testing, set it to the stored value
            if (formData.ab_testing !== undefined) {
                $("input[name='ab_testing']").prop("checked", formData.ab_testing);
            }
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var $contentlis = $('.tabsContent li'),
            $tabslis = $('.tabsButtons li');

        var INACTIVITY_LIMIT = 1 * 60 * 1000; // 5 minutes
        var lastActivityTime = localStorage.getItem("lastActivityTime") || Date.now();
        var activeIndex = localStorage.getItem("activeTab");

        // Reset to "Create New" if inactive for more than 5 minutes
        if (activeIndex === null || Date.now() - lastActivityTime > INACTIVITY_LIMIT) {
            activeIndex = "0"; // Default to "Create New"
            localStorage.setItem("activeTab", activeIndex);
        } else {
            activeIndex = parseInt(activeIndex);
        }

        console.log("Loaded active tab index:", activeIndex);

        // Apply active tab state
        function setActiveTab(index) {
            $tabslis.removeClass('active-btn').eq(index).addClass('active-btn');
            $contentlis.hide().eq(index).show();
            localStorage.setItem("activeTab", index);
            localStorage.setItem("lastActivityTime", Date.now());
        }

        setActiveTab(activeIndex);

        function toggleResultSections() {
            let activeTab = localStorage.getItem("activeTab");

            if (activeTab === "0") {  
                $("#createNewResultSection").show();
                $("#improveExistingResultSection").hide();

                let createNewResult = localStorage.getItem("createNewResult");
                let createNewData = JSON.parse(localStorage.getItem("createNewData"));
                if (createNewResult) {
                    $(".createNewResult").html(createNewResult); 
                }
                if (createNewData) {
                    for (let key in createNewData) {
                        let inputField = document.querySelector(`[name="${key}"]`);
                        if (inputField) {
                            if (inputField.type === "checkbox") {
                                inputField.checked = createNewData[key];
                            } else {
                                inputField.value = createNewData[key] || "";
                            }
                        }
                    }
                }
            } else {  
                $("#createNewResultSection").hide();
                $("#improveExistingResultSection").show();

                let improveExistingResult = localStorage.getItem("improveExistingResult");
                let improveData = JSON.parse(localStorage.getItem("improveData"));
                if (improveExistingResult) {
                    $(".improveExistingResult").html(improveExistingResult);
                }
                if (improveData) {
                    $("input[name='category']").val(improveData.category || "");
                    $("input[name='brand']").val(improveData.brand || "");
                    $("select[name='medium']").val(improveData.medium || "");
                    $("input[name='specific_input']").val(improveData.specific_input || "");

                    if (improveData.ab_testing !== undefined) {
                        $("input[name='ab_testing']").prop("checked", improveData.ab_testing);
                    }
                    if (improveData.existing_content) {
                        $("textarea[name='existing_content']").val(improveData.existing_content);
                    }
                }
            }
        }

        function switchTab(index) {
            console.log("Switching to tab index:", index);
            setActiveTab(index);

            // Handle chatbot result transition
            if (index === 1 && localStorage.getItem("createNewResult")) {
                $("textarea[name='existing_content']").val(localStorage.getItem("createNewResult"));
                $("input[name='category']").val(localStorage.getItem("Category"));
                $("select[name='medium']").val(localStorage.getItem("Medium"));
                $("input[name='brand']").val(localStorage.getItem("Brand"));
            }

            toggleResultSections();
        }

        $(".tabsButtons li").each(function (index) {
            $(this).on("click", function () {
                switchTab(index);
            });
        });

        toggleResultSections();

        // Track user activity to reset inactive sessions
        $(document).on("mousemove keydown click", function () {
            localStorage.setItem("lastActivityTime", Date.now());
        });
    });
</script>
<script>
function validateLength(input, maxLength) {
    const currentLength = input.value.length;
    
    // Use the identifier to find the error message element.
    const errorMessageElement = document.querySelector(`#${input.getAttribute('identifier')}Error`);

    // Check if errorMessageElement exists before proceeding
    if (errorMessageElement) {
        // Check if the character length exceeds the maxLength
        if (currentLength > maxLength) {
            errorMessageElement.style.display = 'inline';
            errorMessageElement.textContent = 'Character limit exceeded! Max ' + maxLength + ' characters allowed.';
            input.classList.add('error');  // Optional: Add a class to highlight the input (e.g., with a red border)
        } else {
            errorMessageElement.style.display = 'none';
            errorMessageElement.textContent = '';  // Clear the error message
            input.classList.remove('error');
        }
    }
}

</script>


</body>
</html>

